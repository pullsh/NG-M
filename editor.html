<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor</title>
    <link rel="stylesheet" href="css/editor-styles.css">
</head>
<body>
    <video class="background-video" autoplay loop muted>
        <source src="videos/NextGen_Mobil_BG_4s_loop.webm" type="video/webm">
    </video>
    <div class="logo-header">
        <video class="logo-animation" autoplay muted>
            <source src="videos/NG_Mobil_Logo_BildWort_inverted_Motiongraphic.webm" type="video/webm">
        </video>
        <img id="partnerCert" class="partner-cert" src="images/partner-cert.svg" alt="Partner Certification">
    </div>
    <div class="container">
        <div class="provider-features">
            <div class="provider-logo-container">
                <select id="providerLogoSelect" class="provider-logo-select">
                    <option value="images/logos/1und1_logo.svg">1&1</option>
                    <option value="images/logos/Telekom_logo.svg">Telekom</option>
                    <option value="images/logos/Vodafone_logo.svg">Vodafone</option>
                    <option value="images/logos/CONGSTAR_logo.svg">Congstar</option>
                    <option value="images/logos/OTELO_schwarz.svg">Otelo</option>
                    <!-- Add more options as needed -->
                </select>
                <img id="providerLogoPreview" class="provider-logo-preview" src="images/logos/1und1_logo.svg" alt="Provider Logo Preview">
            </div>
            <div class="feature-price-big-columns">
                <div class="feature-price-big-left">
                    <input type="text" id="featurePriceBig1" class="feature-price-big1" placeholder="39,">
                </div>
                <div class="feature-price-big-right">
                    <input type="text" id="featurePriceBig2" class="feature-price-big2" placeholder="99€">
                    <input type="text" id="featureMonthly" class="feature-monthly" placeholder="mtl.">
                </div>
            </div>
            <div class="feature-price-small-columns">
                <input type="text" id="featurePriceSmall" class="feature-price-small" placeholder="0,-€">
                <input type="text" id="featureOnetime" class="feature-onetime" placeholder="Zuzahlung">
            </div>
            <textarea id="featureAnnotation" class="feature-annotation" placeholder="Fußnote"></textarea>
        </div>
        <div class="middle-product-image">
            <input type="file" id="productImage" class="product-image" accept="image/*" onchange="previewProductImage()" style="width: auto;">
            <img id="productImagePreview" class="product-image-preview" src="" alt="Produktbild Vorschau" style="min-width: 100%;">
            <div class="slider-container">
                <label for="imageWidthSlider">Bildbreite:</label>
                <input type="range" id="imageWidthSlider" min="50" max="150" value="100" oninput="updateImageWidth(this.value)">
                <span id="imageWidthValue">100%</span>
            </div>
            <div class="download-section">
                <input type="text" id="fileName" placeholder="Dateiname">
                <button onclick="downloadHTML()">Datei speichern (HTML)</button>
            </div>
        </div>
        <div class="product-specs">
            <img id="productSpecsLine" class="product-specs-line" src="images/product-specs-line.svg" alt="Product Specs Line">
            <div class="product-specs-right">
                <input type="text" id="contractName" class="contract-name" placeholder="Vertrag">
                <div class="feature-data-limit-container">
                    <img id="featureDataLimit" class="feature-data-limit" src="images/feature-data-limit.svg" alt="Data Limit">
                    <input type="checkbox" id="featureDataLimitCheckbox">
                </div>
                <textarea id="providerSpecsList" class="provider-specs-list" placeholder="Vertragsdetails (kommagetrennt)"></textarea>
                <input type="text" id="productName" class="product-name" placeholder="Produkt">
                <textarea id="productSpecsList" class="product-specs-list" placeholder="Produktdetails (kommagetrennt)"></textarea>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('providerLogoSelect').addEventListener('change', function() {
            const selectedLogo = this.value;
            document.getElementById('providerLogoPreview').src = selectedLogo;
        });

        function previewProductImage() {
            const file = document.getElementById('productImage').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('productImagePreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function updateImageWidth(value) {
            document.getElementById('productImagePreview').style.minWidth = `${value}%`;
            document.getElementById('imageWidthValue').textContent = `${value}%`;
        }

        function downloadHTML() {
            const data = {
                providerLogo: document.getElementById('providerLogoSelect').value,
                featurePriceBig1: document.getElementById('featurePriceBig1').value,
                featurePriceBig2: document.getElementById('featurePriceBig2').value,
                featureMonthly: document.getElementById('featureMonthly').value,
                featurePriceSmall: document.getElementById('featurePriceSmall').value,
                featureOnetime: document.getElementById('featureOnetime').value,
                featureAnnotation: document.getElementById('featureAnnotation').value,
                productImage: document.getElementById('productImage').files[0] ? `images/${document.getElementById('productImage').files[0].name}` : '',
                productImageWidth: document.getElementById('imageWidthSlider').value,
                contractName: document.getElementById('contractName').value,
                featureDataLimit: document.getElementById('featureDataLimitCheckbox').checked ? document.getElementById('featureDataLimit').value : '',
                providerSpecsList: document.getElementById('providerSpecsList').value.split(',').map(item => item.trim()),
                productName: document.getElementById('productName').value,
                productSpecsList: document.getElementById('productSpecsList').value.split(',').map(item => item.trim()),
            };

            const fileName = document.getElementById('fileName').value || 'data';

            const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${fileName}</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
</head>
<body>
    <video class="background-video" autoplay loop muted>
        <source src="videos/NextGen_Mobil_BG_4s_loop.webm" type="video/webm">
    </video>
    <div class="logo-header">
        <dotlottie-player id="logoAnimation" class="logo-animation" src="images/next gen mobil motion_inverted.lottie" 
            background="transparent" speed="1" style="width: 100%; height: 100%" direction="1" playMode="forwards" autoplay>
        </dotlottie-player>
        <img id="partnerCert" class="partner-cert" src="images/partner-cert.svg" alt="Partner Certification">
    </div>
    <div class="container">
        <div class="provider-features">
            <img id="providerLogo" class="provider-logo" src="${data.providerLogo}" alt="Provider Logo">
            <div class="feature-price-big-columns">
                <div class="feature-price-big-left">
                    <h1 id="featurePriceBig1" class="feature-price-big1">${data.featurePriceBig1}</h1>
                </div>
                <div class="feature-price-big-right">
                    <h2 id="featurePriceBig2" class="feature-price-big2">${data.featurePriceBig2}</h2>
                    <p id="featureMonthly" class="feature-monthly">${data.featureMonthly}</p>
                </div>
            </div>
            <div class="feature-price-small-columns">
                <h3 id="featurePriceSmall" class="feature-price-small">${data.featurePriceSmall}</h3>
                <p id="featureOnetime" class="feature-onetime">${data.featureOnetime}</p>
            </div>
            <p id="featureAnnotation" class="feature-annotation">${data.featureAnnotation}</p>
        </div>
        <div class="middle-product-image">
            <img id="productImage" class="product-image" src="${data.productImage}" alt="Product Image" style="min-width: ${data.productImageWidth}%; max-width: 100%;">
        </div>
        <div class="product-specs">
            <img id="productSpecsLine" class="product-specs-line" src="images/product-specs-line.svg" alt="Product Specs Line">
            <div class="product-specs-right">
                <h4 id="contractName" class="contract-name">${data.contractName}</h4>
                ${data.featureDataLimit ? `<img id="featureDataLimit" class="feature-data-limit" src="${data.featureDataLimit}" alt="Data Limit">` : ''}
                <ul id="providerSpecsList" class="provider-specs-list">
                    ${data.providerSpecsList.map(spec => `<li>${spec}</li>`).join('')}
                </ul>
                <h4 id="productName" class="product-name">${data.productName}</h4>
                <ul id="productSpecsList" class="product-specs-list">
                    ${data.productSpecsList.map(spec => `<li>${spec}</li>`).join('')}
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
            `;

            const htmlBlob = new Blob([htmlContent], { type: 'text/html' });
            const htmlUrl = URL.createObjectURL(htmlBlob);
            const htmlLink = document.createElement('a');
            htmlLink.href = htmlUrl;
            htmlLink.download = `${fileName}.html`;
            htmlLink.click();

            alert('Bitte überprüfen, ob das Produktbild im Ordner "images" bereitgestellt ist.');
        }
    </script>
</body>
</html>